<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Customer Tickets Template -->
    <template id="customer_tickets" name="Customer Tickets">
        <t t-call="web.layout">
            <t t-set="head">
                <!-- Bootstrap 5 CSS -->
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
                    rel="stylesheet" />
                <link
                    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
                    rel="stylesheet" />

                <!-- Custom Dashboard CSS -->
                <link rel="stylesheet" href="/customer_support/static/src/css/portal_dashboard.css" />
                <link rel="stylesheet" href="/customer_support/static/src/css/portal_tickets.css" />
                <style>

                </style>
            </t>

            <div class="dashboard-wrapper">
                <!-- Top Navigation Header -->
                <header class="dashboard-header">
                    <div class="header-content">
                        <div class="header-nav">
                            <a href="/customer_support/dashboard" class="nav-link">
                                <i class="bi bi-speedometer2 me-2"></i>Overview </a>
                            <a href="/customer_support/tickets" class="nav-link active">
                                <i class="bi bi-ticket-detailed me-2"></i>Tickets </a>
                            <a href="#" class="nav-link">
                                <i class="bi bi-graph-up me-2"></i>Reporting </a>
                            <a href="#" class="nav-link">
                                <i class="bi bi-question-circle me-2"></i>FAQ </a>
                        </div>
                        <div class="header-right">
                            <!-- New Ticket Button -->
                            <div class="header-actions">
                                <a href="/customer_support/create_ticket" class="btn-new-ticket">
                                    <i class="bi bi-plus-circle me-2"></i>New Ticket </a>
                            </div>

                            <!-- User Profile -->
                            <div class="user-profile dropdown">
                                <i class="bi bi-grid-3x3-gap-fill text-white me-3"
                                    style="font-size: 1.2rem; cursor: pointer;"></i>

                                <i class="bi bi-bell-fill text-white me-3"
                                    style="font-size: 1.2rem; cursor: pointer;"></i>

                                <!-- Clickable Profile -->
                                <a class="d-flex align-items-center text-white dropdown-toggle"
                                    href="#"
                                    id="userProfileDropdown"
                                    data-bs-toggle="dropdown"
                                    aria-expanded="false"
                                    style="text-decoration: none;">

                                    <span class="user-name me-3">
                                        <t t-esc="user.name" />
                                    </span>

                                    <img t-att-src="'/web/image/res.users/%s/avatar_128' % user.id"
                                        alt="User Avatar"
                                        class="user-avatar"
                                        onerror="this.src='/web/static/img/avatar_gray.svg'" />
                                </a>

                                <!-- Dropdown Menu -->
                                <ul class="dropdown-menu dropdown-menu-end"
                                    aria-labelledby="userProfileDropdown">

                                    <li>
                                        <a class="dropdown-item"
                                            href="/customer_support/profile">
                                            <i class="bi bi-person me-2"></i> Edit Profile </a>
                                    </li>

                                    <li>
                                        <hr class="dropdown-divider" />
                                    </li>

                                    <li>
                                        <a class="dropdown-item text-danger"
                                            href="/customer_support/logout_manual">
                                            <i class="bi bi-box-arrow-right me-2"></i> Logout </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Tickets Content -->
                <div class="dashboard-content">
                    <!-- Page Header -->
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="bi bi-ticket-detailed me-2"></i>My Tickets </h1>
                        <div class="page-stats">
                            <span class="stat-badge">
                                <i class="bi bi-folder-plus me-1"></i>
                                <t t-esc="ticket_count" />
                                Total </span>
                            <span class="stat-badge">
                                <i class="bi bi-clock-history me-1"></i>
                                <t t-esc="len(open_tickets)" />
                                Open </span>
                            <span class="stat-badge">
                                <i class="bi bi-check-circle me-1"></i>
                                <t
                                    t-esc="len(resolved_tickets)" /> Resolved </span>
                        </div>
                    </div>

                    <!-- Search Bar -->
                    <div class="search-container">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control"
                                placeholder="Search tickets..." id="ticket-search" />
                            <button class="btn btn-outline-secondary" type="button"
                                id="clear-search">
                                Clear
                            </button>
                        </div>
                    </div>

                    <!-- Filter Bar -->
                    <div class="filter-container">
                        <span class="filter-label">Filter by:</span>
                        <select class="form-select" id="status-filter" style="width: 150px;">
                            <option value="">All Status</option>
                            <option value="new">New</option>
                            <option value="assigned">Assigned</option>
                            <option value="in_progress">In Progress</option>
                            <option value="pending">Pending</option>
                            <option value="resolved">Resolved</option>
                            <option value="closed">Closed</option>
                        </select>
                        <select class="form-select" id="priority-filter" style="width: 150px;">
                            <option value="">All Priority</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>

                    <!-- Tickets List -->
                    <div class="tickets-container">
                        <t t-if="tickets">
                            <div class="tickets-list" id="tickets-list">
                                <t t-foreach="tickets" t-as="ticket">
                                    <div class="ticket-card" t-att-data-ticket-id="ticket.id">
                                        <!-- Ticket Header -->
                                        <div class="ticket-header">
                                            <div class="ticket-id-container">
                                                <span class="ticket-id">
                                                    <t t-esc="ticket.name" />
                                                </span>
                                                <span
                                                    t-att-class="'ticket-status-badge status-' + ticket.state">
                                                    <t
                                                        t-esc="ticket.state.replace('_', ' ').title()" />
                                                </span>
                                                <t t-if="ticket.is_overdue">
                                                    <span class="badge bg-danger ms-2">Overdue</span>
                                                </t>
                                            </div>
                                            <span
                                                t-att-class="'priority-badge priority-' + ticket.priority">
                                                <t t-esc="ticket.priority.title()" />
                                            </span>
                                        </div>

                                        <!-- Ticket Title -->
                                        <h5 class="ticket-title">
                                            <t t-esc="ticket.subject" />
                                        </h5>

                                        <!-- Ticket Description -->
                                        <p class="ticket-description">
                                            <t t-esc="ticket.description[:150]" />
                                            <t t-if="len(ticket.description) > 150">...</t>
                                        </p>

                                        <!-- Ticket Footer -->
                                        <div class="ticket-footer">
                                            <div class="assigned-info">
                                                <span class="assigned-to"> Assigned to <t
                                                        t-esc="ticket.assigned_to.name if ticket.assigned_to else 'Unassigned'" />
                                                </span>
                                                <span class="project-info">
                                                    <t t-esc="ticket.priority.title()" /> Priority </span>
                                            </div>
                                            <div class="date-info">
                                                <span class="closed-date">
                                                    <i class="bi bi-calendar-check"></i>
                                                    <span>
                                                        <t
                                                            t-if="ticket.state in ['resolved', 'closed']">
                                                            <t t-if="ticket.closed_date"> Closed <t
                                                                    t-esc="ticket.closed_date.strftime('%b %d, %Y %I:%M %p')" />
                                                            </t>
                                                            <t t-else="">
                                                                Closed Recently
                                                            </t>
                                                        </t>
                                                        <t t-else=""> Created <t
                                                                t-esc="ticket.create_date.strftime('%b %d, %Y') if ticket.create_date else 'N/A'" />
                                                        </t>
                                                    </span>
                                                </span>
                                                <span class="update-time">
                                                    <i class="bi bi-clock-history"></i>
                                                    <t t-esc="ticket.days_open" />
                                                    <t t-if="ticket.days_open == 1">day open</t>
                                                    <t t-else="">days open</t>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </t>
                        <t t-if="not tickets">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="bi bi-ticket"></i>
                                </div>
                                <h3 class="mb-3">No Tickets Yet</h3>
                                <p class="text-muted mb-4">You haven't created any support tickets
                                    yet.</p>
                                <a href="/customer_support/create_ticket" class="btn btn-primary">
                                    <i class="bi bi-plus-circle me-2"></i>Create Your First Ticket </a>
                            </div>
                        </t>
                    </div>
                </div>
            </div>

            <!-- Bootstrap JS -->
            <script
                src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

            <!-- Tickets JavaScript -->
            <script> document.addEventListener('DOMContentLoaded', function() { // Search
                functionality const searchInput = document.getElementById('ticket-search'); const
                statusFilter = document.getElementById('status-filter'); const priorityFilter =
                document.getElementById('priority-filter'); const ticketsList =
                document.getElementById('tickets-list'); const clearSearchBtn =
                document.getElementById('clear-search'); function filterTickets() { const searchTerm
                = searchInput.value.toLowerCase(); const statusValue = statusFilter.value; const
                priorityValue = priorityFilter.value; if (ticketsList) { const ticketCards =
                ticketsList.querySelectorAll('.ticket-card'); ticketCards.forEach(card => { const
                title = card.querySelector('.ticket-title').textContent.toLowerCase(); const
                description = card.querySelector('.ticket-description').textContent.toLowerCase();
                const statusBadge = card.querySelector('.ticket-status-badge'); const priorityBadge
                = card.querySelector('.priority-badge'); let statusClass = ''; if (statusBadge) {
                statusClass = statusBadge.className; } let priorityClass = ''; if (priorityBadge) {
                priorityClass = priorityBadge.className; } const matchesSearch = searchTerm === ''
                || title.includes(searchTerm) || description.includes(searchTerm); const
                matchesStatus = statusValue === '' || statusClass.includes('status-' + statusValue);
                const matchesPriority = priorityValue === '' || priorityClass.includes('priority-' +
                priorityValue); if (matchesSearch &amp; matchesStatus &amp; matchesPriority) {
                card.style.display = 'block'; } else { card.style.display = 'none'; } }); // Show
                empty message if no tickets match const visibleTickets =
                Array.from(ticketCards).filter(card => card.style.display !== 'none' ); if
                (visibleTickets.length === 0 &amp; ticketsList.querySelector('.no-results-message')
                === null) { const noResults = document.createElement('div'); noResults.className =
                'empty-state no-results-message'; noResults.innerHTML = ` <div
                    class="empty-state-icon">
                    <i class="bi bi-search"></i>
                </div>
                                    <h3 class="mb-3">No Tickets
                Found</h3>
                                    <p class="text-muted mb-4">Try adjusting your search or filters</p>
                                    <button
                    class="btn btn-outline-primary" id="clear-filters">
                    Clear All Filters
                </button> `;
                ticketsList.appendChild(noResults); // Add event listener to clear filters button
                document.getElementById('clear-filters').addEventListener('click', function() {
                searchInput.value = ''; statusFilter.value = ''; priorityFilter.value = '';
                filterTickets(); }); } else { const noResultsMsg =
                ticketsList.querySelector('.no-results-message'); if (noResultsMsg) {
                noResultsMsg.remove(); } } } } // Event listeners
                searchInput.addEventListener('input', filterTickets);
                statusFilter.addEventListener('change', filterTickets);
                priorityFilter.addEventListener('change', filterTickets);
                clearSearchBtn.addEventListener('click', function() { searchInput.value = '';
                statusFilter.value = ''; priorityFilter.value = ''; filterTickets(); }); // Make
                ticket cards clickable document.querySelectorAll('.ticket-card').forEach(card => {
                card.addEventListener('click', function(e) { // Don't trigger if clicking on a link
                or button inside if (!e.target.closest('a') &amp; !e.target.closest('button')) {
                const ticketId = this.getAttribute('data-ticket-id'); if (ticketId) {
                window.location = '/customer_support/ticket/' + ticketId; } } }); }); }); </script>
        </t>
    </template>
</odoo>